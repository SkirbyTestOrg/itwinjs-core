"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/*---------------------------------------------------------------------------------------------
|  $Copyright: (c) 2017 Bentley Systems, Incorporated. All rights reserved. $
 *--------------------------------------------------------------------------------------------*/
const chai_1 = require("chai");
const Id_1 = require("@bentley/bentleyjs-core/lib/Id");
const Code_1 = require("../../../../frontend/lib/common/Code");
const IModelConnection_1 = require("../../../../frontend/lib/frontend/IModelConnection");
const TestData_1 = require("./TestData");
describe("IModelConnection", () => {
    let accessToken;
    let testProjectId;
    let testIModelId;
    before(async () => {
        accessToken = await TestData_1.TestData.getTestUserAccessToken();
        testProjectId = await TestData_1.TestData.getTestProjectId(accessToken, "NodeJsTestProject");
        testIModelId = await TestData_1.TestData.getTestIModelId(accessToken, testProjectId, "MyTestModel");
    });
    it("should be able to get elements and models from an IModelConnection", async () => {
        const iModel = await IModelConnection_1.IModelConnection.open(accessToken, testIModelId);
        chai_1.assert.exists(iModel);
        chai_1.assert.isTrue(iModel instanceof IModelConnection_1.IModelConnection);
        chai_1.assert.exists(iModel.models);
        chai_1.assert.isTrue(iModel.models instanceof IModelConnection_1.IModelConnectionModels);
        chai_1.assert.exists(iModel.elements);
        chai_1.assert.isTrue(iModel.elements instanceof IModelConnection_1.IModelConnectionElements);
        const elementIds = [iModel.elements.rootSubjectId];
        const elementProps = await iModel.elements.getElementProps(elementIds);
        chai_1.assert.equal(elementProps.length, elementIds.length);
        chai_1.assert.isTrue(iModel.elements.rootSubjectId.equals(new Id_1.Id64(elementProps[0].id)));
        chai_1.assert.isTrue(iModel.models.repositoryModelId.equals(new Id_1.Id64(elementProps[0].model)));
        const queryElementIds = await iModel.elements.queryElementIds({ from: "BisCore.Category", limit: 20, offset: 0 });
        chai_1.assert.isAtLeast(queryElementIds.length, 1);
        chai_1.assert.isTrue(queryElementIds[0] instanceof Id_1.Id64);
        const formatObjs = await iModel.elements.formatElements(queryElementIds);
        chai_1.assert.isAtLeast(formatObjs.length, 1);
        const modelIds = [iModel.models.repositoryModelId];
        const modelProps = await iModel.models.getModelProps(modelIds);
        chai_1.assert.exists(modelProps);
        chai_1.assert.equal(modelProps.length, modelIds.length);
        chai_1.assert.isTrue(iModel.models.repositoryModelId.equals(new Id_1.Id64(modelProps[0].id)));
        const rows = await iModel.executeQuery("SELECT CodeValue AS code FROM BisCore.Category");
        chai_1.assert.isAtLeast(rows.length, 1);
        chai_1.assert.exists(rows[0].code);
        chai_1.assert.equal(rows.length, queryElementIds.length);
        const codeSpecByName = await iModel.codeSpecs.getCodeSpecByName(Code_1.CodeSpecNames.SpatialCategory());
        chai_1.assert.exists(codeSpecByName);
        const codeSpecById = await iModel.codeSpecs.getCodeSpecById(codeSpecByName.id);
        chai_1.assert.exists(codeSpecById);
        await iModel.close(accessToken);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSU1vZGVsQ29ubmVjdGlvbi50bXAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9JTW9kZWxDb25uZWN0aW9uLnRtcC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOztnR0FFZ0c7QUFDaEcsK0JBQThCO0FBQzlCLHVEQUFzRDtBQUV0RCxvREFBb0U7QUFHcEUsOEVBQTZIO0FBQzdILHlDQUFzQztBQUV0QyxRQUFRLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFO0lBQ2hDLElBQUksV0FBd0IsQ0FBQztJQUM3QixJQUFJLGFBQXFCLENBQUM7SUFDMUIsSUFBSSxZQUFvQixDQUFDO0lBRXpCLE1BQU0sQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNoQixXQUFXLEdBQUcsTUFBTSxtQkFBUSxDQUFDLHNCQUFzQixFQUFFLENBQUM7UUFDdEQsYUFBYSxHQUFHLE1BQU0sbUJBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztRQUNsRixZQUFZLEdBQUcsTUFBTSxtQkFBUSxDQUFDLGVBQWUsQ0FBQyxXQUFXLEVBQUUsYUFBYSxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBQzNGLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLG9FQUFvRSxFQUFFLEtBQUssSUFBSSxFQUFFO1FBQ2xGLE1BQU0sTUFBTSxHQUFxQixNQUFNLG1DQUFnQixDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsWUFBWSxDQUFDLENBQUM7UUFDeEYsYUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN0QixhQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sWUFBWSxtQ0FBZ0IsQ0FBQyxDQUFDO1FBQ2xELGFBQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzdCLGFBQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sWUFBWSx5Q0FBc0IsQ0FBQyxDQUFDO1FBQy9ELGFBQU0sQ0FB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RSxDQUFDLENBQUM7UUFDekYsYUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUU1QixNQUFNLE1BQU0sQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDbEMsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbnwgICRDb3B5cmlnaHQ6IChjKSAyMDE3IEJlbnRsZXkgU3lzdGVtcywgSW5jb3Jwb3JhdGVkLiBBbGwgcmlnaHRzIHJlc2VydmVkLiAkXHJcbiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xyXG5pbXBvcnQgeyBhc3NlcnQgfSBmcm9tIFwiY2hhaVwiO1xyXG5pbXBvcnQgeyBJZDY0IH0gZnJvbSBcIkBiZW50bGV5L2JlbnRsZXlqcy1jb3JlL2xpYi9JZFwiO1xyXG5pbXBvcnQgeyBBY2Nlc3NUb2tlbiB9IGZyb20gXCJAYmVudGxleS9pbW9kZWxqcy1jbGllbnRzXCI7XHJcbmltcG9ydCB7IENvZGVTcGVjLCBDb2RlU3BlY05hbWVzIH0gZnJvbSBcIiQoY29tbW9uKS9saWIvY29tbW9uL0NvZGVcIjtcclxuaW1wb3J0IHsgRWxlbWVudFByb3BzIH0gZnJvbSBcIiQoY29tbW9uKS9saWIvY29tbW9uL0VsZW1lbnRQcm9wc1wiO1xyXG5pbXBvcnQgeyBNb2RlbFByb3BzIH0gZnJvbSBcIiQoY29tbW9uKS9saWIvY29tbW9uL01vZGVsUHJvcHNcIjtcclxuaW1wb3J0IHsgSU1vZGVsQ29ubmVjdGlvbiwgSU1vZGVsQ29ubmVjdGlvbkVsZW1lbnRzLCBJTW9kZWxDb25uZWN0aW9uTW9kZWxzIH0gZnJvbSBcIiQoY29tbW9uKS9saWIvZnJvbnRlbmQvSU1vZGVsQ29ubmVjdGlvblwiO1xyXG5pbXBvcnQgeyBUZXN0RGF0YSB9IGZyb20gXCIuL1Rlc3REYXRhXCI7XHJcblxyXG5kZXNjcmliZShcIklNb2RlbENvbm5lY3Rpb25cIiwgKCkgPT4ge1xyXG4gIGxldCBhY2Nlc3NUb2tlbjogQWNjZXNzVG9rZW47XHJcbiAgbGV0IHRlc3RQcm9qZWN0SWQ6IHN0cmluZztcclxuICBsZXQgdGVzdElNb2RlbElkOiBzdHJpbmc7XHJcblxyXG4gIGJlZm9yZShhc3luYyAoKSA9PiB7XHJcbiAgICBhY2Nlc3NUb2tlbiA9IGF3YWl0IFRlc3REYXRhLmdldFRlc3RVc2VyQWNjZXNzVG9rZW4oKTtcclxuICAgIHRlc3RQcm9qZWN0SWQgPSBhd2FpdCBUZXN0RGF0YS5nZXRUZXN0UHJvamVjdElkKGFjY2Vzc1Rva2VuLCBcIk5vZGVKc1Rlc3RQcm9qZWN0XCIpO1xyXG4gICAgdGVzdElNb2RlbElkID0gYXdhaXQgVGVzdERhdGEuZ2V0VGVzdElNb2RlbElkKGFjY2Vzc1Rva2VuLCB0ZXN0UHJvamVjdElkLCBcIk15VGVzdE1vZGVsXCIpO1xyXG4gIH0pO1xyXG5cclxuICBpdChcInNob3VsZCBiZSBhYmxlIHRvIGdldCBlbGVtZW50cyBhbmQgbW9kZWxzIGZyb20gYW4gSU1vZGVsQ29ubmVjdGlvblwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCBpTW9kZWw6IElNb2RlbENvbm5lY3Rpb24gPSBhd2FpdCBJTW9kZWxDb25uZWN0aW9uLm9wZW4oYWNjZXNzVG9rZW4sIHRlc3RJTW9kZWxJZCk7XHJcbiAgICBhc3NlcnQuZXhpc3RzKGlNb2RlbCk7XHJcbiAgICBhc3NlcnQuaXNUcnVlKGlNb2RlbCBpbnN0YW5jZW9mIElNb2RlbENvbm5lY3Rpb24pO1xyXG4gICAgYXNzZXJ0LmV4aXN0cyhpTW9kZWwubW9kZWxzKTtcclxuICAgIGFzc2VydC5pc1RydWUoaU1vZGVsLm1vZGVscyBpbnN0YW5jZW9mIElNb2RlbENvbm5lY3Rpb25Nb2RlbHMpO1xyXG4gICAgYXNzZXJ0LmV4aXN0cyhpTW9kZWwuZWxlbWVudHMpO1xyXG4gICAgYXNzZXJ0LmlzVHJ1ZShpTW9kZWwuZWxlbWVudHMgaW5zdGFuY2VvZiBJTW9kZWxDb25uZWN0aW9uRWxlbWVudHMpO1xyXG5cclxuICAgIGNvbnN0IGVsZW1lbnRJZHM6IElkNjRbXSA9IFtpTW9kZWwuZWxlbWVudHMucm9vdFN1YmplY3RJZF07XHJcbiAgICBjb25zdCBlbGVtZW50UHJvcHM6IEVsZW1lbnRQcm9wc1tdID0gYXdhaXQgaU1vZGVsLmVsZW1lbnRzLmdldEVsZW1lbnRQcm9wcyhlbGVtZW50SWRzKTtcclxuICAgIGFzc2VydC5lcXVhbChlbGVtZW50UHJvcHMubGVuZ3RoLCBlbGVtZW50SWRzLmxlbmd0aCk7XHJcbiAgICBhc3NlcnQuaXNUcnVlKGlNb2RlbC5lbGVtZW50cy5yb290U3ViamVjdElkLmVxdWFscyhuZXcgSWQ2NChlbGVtZW50UHJvcHNbMF0uaWQpKSk7XHJcbiAgICBhc3NlcnQuaXNUcnVlKGlNb2RlbC5tb2RlbHMucmVwb3NpdG9yeU1vZGVsSWQuZXF1YWxzKG5ldyBJZDY0KGVsZW1lbnRQcm9wc1swXS5tb2RlbCkpKTtcclxuXHJcbiAgICBjb25zdCBxdWVyeUVsZW1lbnRJZHM6IElkNjRbXSA9IGF3YWl0IGlNb2RlbC5lbGVtZW50cy5xdWVyeUVsZW1lbnRJZHMoeyBmcm9tOiBcIkJpc0NvcmUuQ2F0ZWdvcnlcIiwgbGltaXQ6IDIwLCBvZmZzZXQ6IDAgfSk7XHJcbiAgICBhc3NlcnQuaXNBdExlYXN0KHF1ZXJ5RWxlbWVudElkcy5sZW5ndGgsIDEpO1xyXG4gICAgYXNzZXJ0LmlzVHJ1ZShxdWVyeUVsZW1lbnRJZHNbMF0gaW5zdGFuY2VvZiBJZDY0KTtcclxuXHJcbiAgICBjb25zdCBmb3JtYXRPYmpzOiBhbnlbXSA9IGF3YWl0IGlNb2RlbC5lbGVtZW50cy5mb3JtYXRFbGVtZW50cyhxdWVyeUVsZW1lbnRJZHMpO1xyXG4gICAgYXNzZXJ0LmlzQXRMZWFzdChmb3JtYXRPYmpzLmxlbmd0aCwgMSk7XHJcblxyXG4gICAgY29uc3QgbW9kZWxJZHM6IElkNjRbXSA9IFtpTW9kZWwubW9kZWxzLnJlcG9zaXRvcnlNb2RlbElkXTtcclxuICAgIGNvbnN0IG1vZGVsUHJvcHM6IE1vZGVsUHJvcHNbXSA9IGF3YWl0IGlNb2RlbC5tb2RlbHMuZ2V0TW9kZWxQcm9wcyhtb2RlbElkcyk7XHJcbiAgICBhc3NlcnQuZXhpc3RzKG1vZGVsUHJvcHMpO1xyXG4gICAgYXNzZXJ0LmVxdWFsKG1vZGVsUHJvcHMubGVuZ3RoLCBtb2RlbElkcy5sZW5ndGgpO1xyXG4gICAgYXNzZXJ0LmlzVHJ1ZShpTW9kZWwubW9kZWxzLnJlcG9zaXRvcnlNb2RlbElkLmVxdWFscyhuZXcgSWQ2NChtb2RlbFByb3BzWzBdLmlkKSkpO1xyXG5cclxuICAgIGNvbnN0IHJvd3M6IGFueVtdID0gYXdhaXQgaU1vZGVsLmV4ZWN1dGVRdWVyeShcIlNFTEVDVCBDb2RlVmFsdWUgQVMgY29kZSBGUk9NIEJpc0NvcmUuQ2F0ZWdvcnlcIik7XHJcbiAgICBhc3NlcnQuaXNBdExlYXN0KHJvd3MubGVuZ3RoLCAxKTtcclxuICAgIGFzc2VydC5leGlzdHMocm93c1swXS5jb2RlKTtcclxuICAgIGFzc2VydC5lcXVhbChyb3dzLmxlbmd0aCwgcXVlcnlFbGVtZW50SWRzLmxlbmd0aCk7XHJcblxyXG4gICAgY29uc3QgY29kZVNwZWNCeU5hbWU6IENvZGVTcGVjID0gYXdhaXQgaU1vZGVsLmNvZGVTcGVjcy5nZXRDb2RlU3BlY0J5TmFtZShDb2RlU3BlY05hbWVzLlNwYXRpYWxDYXRlZ29yeSgpKTtcclxuICAgIGFzc2VydC5leGlzdHMoY29kZVNwZWNCeU5hbWUpO1xyXG4gICAgY29uc3QgY29kZVNwZWNCeUlkOiBDb2RlU3BlYyA9IGF3YWl0IGlNb2RlbC5jb2RlU3BlY3MuZ2V0Q29kZVNwZWNCeUlkKGNvZGVTcGVjQnlOYW1lLmlkKTtcclxuICAgIGFzc2VydC5leGlzdHMoY29kZVNwZWNCeUlkKTtcclxuXHJcbiAgICBhd2FpdCBpTW9kZWwuY2xvc2UoYWNjZXNzVG9rZW4pO1xyXG4gIH0pO1xyXG59KTtcclxuIl19